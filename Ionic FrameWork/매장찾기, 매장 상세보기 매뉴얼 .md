# App

## 구성

- pages

```
store
 ┣ find-store
 ┃ ┣ find-store-routing.module.ts
 ┃ ┣ find-store.module.ts
 ┃ ┣ find-store.page.html
 ┃ ┣ find-store.page.scss
 ┃ ┗ find-store.page.ts
 ┃
 ┣ find-store-detail
 ┃ ┣ find-store-detail-routing.module.ts
 ┃ ┣ find-store-detail.module.ts
 ┃ ┣ find-store-detail.page.html
 ┃ ┣ find-store-detail.page.scss
 ┃ ┗ find-store-detail.page.ts
```



- components

```
store-item
 ┣ store-item.component.html
 ┣ store-item.component.scss
 ┗ store-item.component.ts
```



- services

```
services
 ┗ find-store.service.ts
```



# Naver Cloud Platform Map API

### Naver Cloud Platform Map API 바로가기

- 기존에 사용했던 Naver Maps Api v3는 2019년 4월 15일부터 서비스가 종료되었다.



- 네이버 개발자센터의 지도 Open API 서비스가 종료되고, 이후부터는 네이버 클라우드 플랫폼을 통해서만 Maps API를 제공받을 수 있다.



- [네이버 클라우드 플랫폼에서 Map API 바로가기](https://navermaps.github.io/maps.js.ncp/docs/tutorial-1-Conceptual-Overview.html)



### Naver Cloud Platform Map API 사용하기

- [Naver Cloud Platform Map API 계정 설정 및 등록하는 방법](#naver-cloud-platform-map-api-계정-설정-및-등록하는-방법) (Client ID를 받급받지 않은 상태면 클릭~!)

-  [이 곳](https://navermaps.github.io/maps.js.ncp/docs/tutorial-2-Getting-Started.html)에 들어가 지도를 생성하는 예제를 확인하고 본인의 `index.html` 파일에 아래의 코드만 복사하여 붙여넣는다.

``` html
<script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=YOUR_CLIENT_ID"></script>
```

> 그대로 입력하되 YOUR_CLIENT_ID 부분엔 본인이 발급 받은 CLIENT_ID를 작성해줘야 한다.



- 코드를 작성할 TypeScript 파일 (find-store.page.ts) 에 아래의 코드를 작성해줘야 한다.

```typescript
declare let naver: any;
```

> 공식 지원하지 않으므로, `naver` 객체를 `declare` 로 선언하여 불러주어야 한다.



- [Naver Map](https://navermaps.github.io/maps.js.ncp/docs/naver.maps.html)의 사이트에 들어가 Maps 클래스들의 종류와 속성 각각의 기능 등을 참고한다.



- CSS를 통해 화면 상에 지도를 좀 더 깔끔하게 나타나게 할 수 있는데, 이 때 `@media` 를 활용하면 된다. 아래는 예시 코드

```scss
 #map {
    width: 100%;
    // 미디어 타입이 all이고, 최소 높이가 500px이면, 지도의 높이를 300px로 적용
    @media all and (min-height: 500px) {
      height: 300px;
    }
    // 미디어 타입이 all이고, 최소 높이가 600px이면, 지도의 높이를 380px로 적용
    @media all and (min-height: 600px) {
      height: 380px;
    }
```

> [@Media 더 알아보러 가기](https://developer.mozilla.org/ko/docs/Web/CSS/@media)
>
> 이런 식으로 @media를 통해 CSS를 작성하는 이유는 사용자마다 모두 다른 크기의 Device를 통해 지도를 볼 것이기 때문이다.
>
> 따라서 지도의 크기를 화면의 크기에 따라 알맞게 설정해줌으로써 사용자들이 편하게 지도를 볼 수 있도록 구현해야 한다.



# 매장 찾기 Page 기능

### 검색 기능

- 매장명 혹은 지역명을 입력해 사용자가 원하는 매장을 나타나게 할 수 있다.



- 만일 아무것도 입력하지 않거나, 2글자 미만, 입력한 매장이 없는 경우 알림창을 띄워 사용자가 다시 입력할 수 있도록 한다.



- X 버튼을 클릭하면 검색창에 입력했던 글자가 초기화 된다.



### 슬라이드 기능 및 마커, 정보창 기능

- 처음 접속했을 때, 서울에 있는 매장을 기준으로 마커와 정보창을 띄워준다. (카메라 줌 10)



- 화면 하단에 해당 지역의 모든 매장에 대한 정보를 슬라이드 형태로 나타나게 한다.
  - 슬라이드에 나타날 매장에 대한 정보는 component 파일로 작성하여 Page 파일에서 추가시켜준다.



- 마커를 클릭하면, 클릭한 마커가 지도의 중심이 되도록 이동하고 마커의 번호 색이 바뀐다. 또한 화면 하단의 슬라이드도 마커의 매장에 맞게 이동한다.



- 슬라이드가 이동하면, 해당 슬라이드에 있는 매장의 마커로 포커스가 이동한다.



- 슬라이드의 아래에 페이징 처리를 하여 해당 지역에 총 몇 개의 매장이 있고 몇 번째 매장을 화면에 나타내고 있는지를 알기 쉽게 한다.



- 슬라이드 혹은 상세보기 버튼을 클릭하면 해당 매장에 대한 상세정보 Page로 이동한다.



### 슬라이드 페이징 처리

- `<ion slides>` 속성 중에 pager를 사용하면 슬라이드 하단에 페이징 처리가 되지만 기본 값 bullet 형식이다.

  - Ionic 3 버전에선 속성으로 `paginationType`이 있어서 `paginationType="fraction"`을 설정해주면 됐지만 Ionic 5 버전에선 아래와 같이 해줘야 한다.
  - 1/25 처럼, 총 몇 개의 슬라이드에 현재는 몇 번째 슬라이드 인지를 보기 쉽게 나타내기 위해선 아래의 코드를 사용해야 한다.

  ``` html
  <ion-slides pager [options]="{pagination: { el: '.swiper-pagination', type: 'fraction'} }"
  ```

  > el => 요소 명
  >
  > type => pagination (페이지 매김) 타입



### 매장 찾기 Page에서 매장 상세정보 Page로 넘어갈 때 데이터 실어서 넘기기

- Page와 Page간에 화면 전환을 할 때 유용하게 사용되는 Angular API인 `Router` 를 활용하면 상세보기 Page에서 다시 매장 찾기 Page로 이동했을 때 지도가 초기화 된다.



- 따라서 ModalController를 활용하여 구현해야 하는데 이 때 Modal을 통해 데이터를 실어서 넘기는 방식은 Modal의 속성 중 `componentProps`를 활용하면 된다. [(Ion-modal 공식 사이트)](https://ionicframework.com/docs/api/modal)



# 매장 상세정보 Page 기능

### 매장 찾기 Page에서 보낸 데이터 받기

- 보낸 데이터를 받는 방법은 몇 가지 있지만 보편적으로 많이 쓰이는 방법인 `navParams` 를 활용하면 된다.
  - [navParams](https://ionicframework.com/docs/v3/api/navigation/NavParams/)는 Ionic 3 버전에서 사용되지만 Ionic 5 버전에서 사용해도 무방하다.



### 상세정보 목록

- 매장 이름 (store_name)
- 매장 주소 (store_way)
- 매장 취급 (store_type) (카페인지, 음식점인지, 정육점인지 등등)

- 매장 번호 (phone)
- 멤버쉽 혜택 (membership)
- 위도 좌표 값 (lat)
- 경도 좌표 값 (lng)

- 지도의 카메라 줌을 19로 설정하여, 매장 찾기 Page보다 9나 증가시켜 사용자가 더 확실히 매장의 위치를 확인할 수 있도록 한다.



### 매장 전화 기능

- 해당 매장 번호를 클릭하면 각각의 Mobile OS에 따라 기능을 한다. 
  - `<a href="tel:1234-5678">` 활용하여 구현
  - `Android` 다이얼 패드가 열리고 매장 번호가 자동으로 입력되어 있다.
  - `IOS` 해당 매장의 번호와 취소, 2가지 선택사항이 있는 Action-Sheet을 나타내어 사용자가 선택할 수 있도록 한다.



### 주소 복사

- `주소 복사` 버튼을 클릭하면 해당 매장의 주소가 클립보드에 복사되고, 클립보드에 복사했다는 토스트 메시지를 화면 하단에 띄워준다. 
- 사용자가 다른 곳에 검색을 하거나 붙여넣기 편하게 한다.
  - Capacitor Plugin 중 [Clipboard](https://capacitorjs.com/docs/apis/clipboard)를 활용하여 구현



# Naver Cloud Platform Map API 계정 설정 및 등록하는 방법

- [이 링크](https://www.ncloud.com/product/applicationService/maps)를 통해 접속한 후, `이용 신청하기` 를 클릭하면 로그인 창이 뜰 것인데, 아이디가 없다면 회원가입을 있다면 로그인을 하면 된다.



- 로그인을 완료했다면, Console창에 들어갈 수 있지만 Map API를 이용하려면 결제 수단을 등록해야 한다.
  - 결제 수단을 등록했다고 해도 모두 유료가 아니고, 무료 API를 이용할 수 있으므로 큰 걱정은 할 필요 없다.
  - 위의 링크를 확인해보면  무료 API 서비스와 각각의 설명을 확인할 수 있다.



- 결제 수단까지 등록을 했다면, Console 창에서 아래 경로대로  클릭하면 된다.
- 한번 설정을 해놓으면 Recently Viewed에 등록되므로 편하게 접속할 수 있다.

```
Products & Services ==> AI.Application Service/AI.NAVER API/ Maps
```



- 위의 과정을 잘 따라왔다면, Application 등록 버튼이 있을 것인데 클릭하면 된다.
  - 간단한 이용동의를 해주면 된다.



- MAPS 상품 선택은 web에서 사용할 것이면 Web Dynamic Map, 모바일에서 사용할 것이라면 Mobile Dynamic Map을 선택하면 된다.

- Application 이름을 영문으로 작성하고, 서비스 환경 등록을 하면 되는데 크게 3가지로 나뉜다. (각각 최대 10개까지 등록 가능)

  1. Web 서비스 (URL)
  2. Android 앱 패키지 이름
  3. IOS Bundle ID

  

- Application 등록이 완료되었다면, 인증 정보 클릭을 통해 Application 이름, Client ID, Clinet Secret, 서비스 환경을 확인할 수 있다.



- [Naver Cloud Platform Map API 사용하기 부분으로 이동하기](#naver-cloud-platform-map-api-사용하기)

